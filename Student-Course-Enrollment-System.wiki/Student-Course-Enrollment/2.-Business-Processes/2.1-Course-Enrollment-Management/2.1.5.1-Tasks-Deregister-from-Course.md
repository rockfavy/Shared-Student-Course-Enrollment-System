# Deregister from a Course â€“ Task Catalogue
---

## Task 1: Create API endpoint to remove student-course relationship

**Description:**  
- **Front-End:** N/A  
- **Back-End:** Create `DELETE /enrollments/{enrollmentId}` endpoint in `EnrollmentEndpoints.cs`. Extract student ID from claims. Verify enrollment belongs to authenticated student. Remove enrollment record from database.  
- **Database:** Delete `Enrollment` record by Id. Ensure foreign key constraints allow deletion.  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class EnrollmentEndpoints {
        +MapEnrollmentEndpoints(WebApplication app)
        +DeleteEnrollmentEndpoint(HttpContext, Guid enrollmentId, EnrollmentService) Task~IResult~
    }
    
    class EnrollmentService {
        +DeleteEnrollmentAsync(Guid enrollmentId, Guid studentId) Task~bool~
        +VerifyEnrollmentOwnership(Guid enrollmentId, Guid studentId) Task~bool~
    }
    
    EnrollmentEndpoints --> EnrollmentService
    EnrollmentService --> EnrollmentContext
:::

### Entity Diagram

::: mermaid
erDiagram
    Enrollment {
        Guid Id PK
        Guid StudentId FK
        Guid CourseId FK
        DateTime EnrolledAt
    }
    
    Student ||--o{ Enrollment : "can remove"
:::

---

## Task 2: Add "Deregister" UI action on the enrolled-courses page

**Description:**  
- **Front-End:** Add "Deregister" button to each enrollment card in `MyEnrollmentsPage.razor`. Implement click handler that calls delete endpoint. Show confirmation dialog before deletion.  
- **Back-End:** N/A  
- **Database:** N/A  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class EnrollmentCard {
        +EnrollmentWithCourse Enrollment
        +DeregisterAsync() Task
        +bool ShowConfirmDialog
    }
    
    class EnrollmentsClient {
        +HttpClient httpClient
        +DeleteEnrollmentAsync(Guid enrollmentId) Task~bool~
    }
    
    EnrollmentCard --> EnrollmentsClient
:::

---

## Task 3: Refresh list after removal

**Description:**  
- **Front-End:** After successful deregistration, refresh the enrollments list by calling `GetMyEnrollmentsAsync()` again. Update UI to reflect removed enrollment.  
- **Back-End:** N/A  
- **Database:** N/A  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class MyEnrollmentsPage {
        +List~EnrollmentWithCourse~ Enrollments
        +DeregisterAsync(Guid enrollmentId) Task
        +RefreshEnrollments() Task
    }
    
    MyEnrollmentsPage --> EnrollmentsClient
:::

---

## Task 4: Validate authentication before deregistering

**Description:**  
- **Front-End:** Ensure user is authenticated before showing deregister button. Use `AuthorizeView` to conditionally render.  
- **Back-End:** Verify student ID from claims matches enrollment's student ID. Return 403 Forbidden if ownership doesn't match.  
- **Database:** N/A  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class EnrollmentEndpoints {
        +DeleteEnrollmentEndpoint(HttpContext, Guid enrollmentId) Task~IResult~
        +RequireAuthorization()
        +VerifyOwnership(Guid enrollmentId, Guid studentId) bool
    }
    
    EnrollmentEndpoints --> AuthorizationMiddleware
:::

---

## Task 5: Update in-memory DB

**Description:**  
- **Front-End:** N/A  
- **Back-End:** Remove enrollment from `Enrollments` DbSet. Call `SaveChangesAsync()` to persist deletion.  
- **Database:** Delete `Enrollment` record from in-memory database.  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class EnrollmentService {
        +DeleteEnrollmentAsync(Guid enrollmentId, Guid studentId) Task~bool~
    }
    
    class EnrollmentContext {
        +DbSet~Enrollment~ Enrollments
        +SaveChangesAsync() Task~int~
    }
    
    EnrollmentService --> EnrollmentContext
:::

### Entity Diagram

::: mermaid
erDiagram
    Enrollment {
        Guid Id PK
        Guid StudentId FK
        Guid CourseId FK
        DateTime EnrolledAt
    }
    
    Student ||--o{ Enrollment : "removes"
:::

---

## Task 6: Display success message

**Description:**  
- **Front-End:** Show success toast notification after deregistration completes. Display "Successfully deregistered from [Course Name]" message.  
- **Back-End:** N/A  
- **Database:** N/A  
- **Infrastructure:** N/A

### Class Diagram

::: mermaid
classDiagram
    class MyEnrollmentsPage {
        +DeregisterAsync(Guid enrollmentId) Task
        +ShowSuccessMessage(string message)
    }
    
    class ToastNotification {
        +ShowSuccess(string message)
    }
    
    MyEnrollmentsPage --> ToastNotification
:::

---

