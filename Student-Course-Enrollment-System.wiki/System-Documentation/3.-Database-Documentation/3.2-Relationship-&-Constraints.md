# Student Course Enrollment System - Relationships & Constraints
---
# 1. Overview

Data entities relate to each other through EF Core relationships, foreign key constraints, and database constraints. These ensure relational integrity across the enrollment system.

These relationships ensure:

- Predictable enrollment dependencies  
- Consistent cross-entity references  
- Valid state transitions  
- Data integrity  
- Stability across all enrollment workflows  

---

# 2. Entity Relationship Diagram

Complete entity relationship diagram showing all entities and their relationships:

::: mermaid
erDiagram
    Student {
        Guid Id PK
        string Email UK "Unique email for login"
        string PasswordHash "Hashed password"
        string FirstName
        string LastName
        DateTime CreatedAt
    }
    
    Course {
        Guid Id PK
        string Name
        string Description
        int Capacity "Maximum enrollment capacity"
        DateTime CreatedAt
    }
    
    Enrollment {
        Guid Id PK
        Guid StudentId FK "References Student.Id"
        Guid CourseId FK "References Course.Id"
        DateTime EnrolledAt "Enrollment timestamp"
    }
    
    Student ||--o{ Enrollment : "has"
    Course ||--o{ Enrollment : "has"
:::

The diagram shows:
- **Student** entity with authentication and personal information
- **Course** entity with course details and capacity
- **Enrollment** entity as the join table linking Students and Courses
- **One-to-Many** relationships: Student → Enrollments, Course → Enrollments
- **Many-to-Many** relationship: Students ↔ Courses (through Enrollment)

---

# 3. Logical Relationships Between Entities

The **Student** and **Course** entities are the anchors of the enrollment data model.

```text
Student
 ├── Enrollments[] (One-to-Many)
     └── Course (Many-to-One)

Course
 ├── Enrollments[] (One-to-Many)
     └── Student (Many-to-One)
```

### Entity Relationships

#### Student → Enrollment  
**1-to-Many relationship**  
A student can have multiple enrollments. Each enrollment belongs to one student.

#### Course → Enrollment  
**1-to-Many relationship**  
A course can have multiple enrollments. Each enrollment belongs to one course.

#### Student ↔ Course (through Enrollment)  
**Many-to-Many relationship**  
Students and courses have a many-to-many relationship through the Enrollment entity.

These logical relationships form the basis of enrollment consistency.

---

# 4. Referential Integrity Constraints

EF Core enforces foreign key constraints through entity relationships.

### Enforced Constraints

- An Enrollment must reference an existing Student.  
- An Enrollment must reference an existing Course.  
- Student email must be unique.  
- Enrollment (StudentId, CourseId) combination must be unique.  
- Orphaned enrollments are prevented by foreign keys.  

These guarantees ensure consistency across entities.

---

# 5. Enrollment Constraints

## 4.1 Duplicate Prevention
- Only one enrollment per student-course combination.  
- Unique index on (StudentId, CourseId) enforces this.  

## 4.2 Enrollment Validation
- Student must exist before enrollment creation.  
- Course must exist before enrollment creation.  
- Enrollment date is set automatically.  

## 4.3 Capacity Constraints (if applicable)
- Course capacity must be checked before enrollment.  
- Enrollment count must not exceed course capacity.  

---

# 6. Entity Constraints

## 5.1 Student Constraints

- Email must be unique (unique index).  
- Email is required.  
- Password hash is required.  
- First name and last name are required.  

## 5.2 Course Constraints

- Course name is required.  
- Course description is optional.  
- Capacity must be non-negative (if applicable).  

## 5.3 Enrollment Constraints

- StudentId is required (foreign key).  
- CourseId is required (foreign key).  
- EnrolledAt is set automatically.  
- Unique constraint on (StudentId, CourseId).  

---

# 7. Cascade Delete Rules

## 6.1 Student Deletion

- If a student is deleted, their enrollments are deleted (Cascade).  
- This prevents orphaned enrollment records.  

## 6.2 Course Deletion

- If a course is deleted, enrollments are restricted (Restrict).  
- Course cannot be deleted if enrollments exist.  
- Enrollments must be removed first.  

---

# 8. Data Integrity Rules

## 7.1 Required Fields

- Student: Email, PasswordHash, FirstName, LastName  
- Course: Name  
- Enrollment: StudentId, CourseId, EnrolledAt  

## 7.2 Unique Constraints

- Student.Email → Unique  
- Enrollment (StudentId, CourseId) → Unique  

## 7.3 Foreign Key Constraints

- Enrollment.StudentId → Student.Id  
- Enrollment.CourseId → Course.Id  

---

# 9. Validation Rules

## 8.1 Email Validation

- Email format must be valid.  
- Email must be unique.  
- Email is case-insensitive for uniqueness.  

## 8.2 Enrollment Validation

- Student must be authenticated.  
- Course must exist.  
- Duplicate enrollment prevented.  
- Capacity checked (if applicable).  

---

# 10. Performance Considerations

## 9.1 Indexes

- Index on Student.Email (unique)  
- Index on Enrollment (StudentId, CourseId) (unique)  
- Index on Enrollment.StudentId (foreign key)  
- Index on Enrollment.CourseId (foreign key)  

## 9.2 Query Optimization

- Use Include() for related entities.  
- Use AsNoTracking() for read-only queries.  
- Use pagination for large datasets.  

---

