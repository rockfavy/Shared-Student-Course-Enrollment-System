# Student Course Enrollment System – In-Memory Database Local Development Setup
---

# 1. Overview

Database configuration for each environment, including appsettings setup, required entities, initialization instructions, and data seeding for testing.

### Environment-Specific Database Configuration

| Environment | Database Type | Configuration |
|-------------|---------------|---------------|
| **Local** | In-memory database | `appsettings.Development.json` |
| **Production** | In-memory database | `appsettings.Production.json` |

All environments use in-memory database that resets on application restart. Only authentication providers differ between environments.

---

# 2. Database Technology

## 2.1 All Environments - In-Memory Database

EF Core In-Memory Provider is used across all environments:

- No external database required  
- Database resets on application restart  
- Supports CRUD operations, entity relationships, and query operations

---

# 3. Environment-Specific Database Configuration

## 3.1 Configuration (All Environments)

All environments use the same in-memory database configuration. Add to the appropriate `appsettings` file:

**appsettings.Development.json** (Local):
```json
{
  "ConnectionStrings": {
    "EnrollmentDb": "Data Source=:memory:"
  }
}
```

**appsettings.Production.json** (Production):
```json
{
  "ConnectionStrings": {
    "EnrollmentDb": "Data Source=:memory:"
  }
}
```

Or configure in `Program.cs`:

```csharp
builder.Services.AddDbContext<EnrollmentContext>(options =>
    options.UseInMemoryDatabase("EnrollmentDb"));
```

All environments use the same in-memory database configuration.  

---

# 4. Required Entities

The application requires exactly:

- **Students** → Student accounts and authentication
- **Courses** → Available courses
- **Enrollments** → Student-course relationships

Entity relationships:

- Student → Enrollments (One-to-Many)
- Course → Enrollments (One-to-Many)
- Enrollment → Student + Course (Many-to-Many through Enrollment)

Startup code automatically creates these if missing.

---

# 5. Database Initialization

## 5.1 Automatic Initialization

On application startup:

1. Run the application (F5 or `dotnet run`)
2. Database is created automatically
3. Seed data is loaded (if configured)

App startup will:

- Create in-memory database
- Create required entities
- Apply entity relationships
- Seed sample data (if configured)

Notes:

- Database is recreated on each application restart
- Data does not persist between runs
- Seed data must be configured in initialization code

---

# 6. Database Initialization Code

## 6.1 Initialization Extension

```csharp
public static async Task InitializeDbAsync(this WebApplication app)
{
    using var scope = app.Services.CreateScope();
    var db = scope.ServiceProvider.GetRequiredService<EnrollmentContext>();
    
    // Seed sample data
    if (!db.Courses.Any())
    {
        db.Courses.AddRange(
            new Course 
            { 
                Id = Guid.NewGuid(),
                Name = "Introduction to Programming", 
                Description = "Learn the fundamentals of programming" 
            },
            new Course 
            { 
                Id = Guid.NewGuid(),
                Name = "Database Design", 
                Description = "Design and implement databases" 
            }
        );
        await db.SaveChangesAsync();
    }
}
```

## 6.2 Call Initialization

In `Program.cs`:

```csharp
await app.InitializeDbAsync();
```

---

# 7. Resetting Database

## 7.1 Automatic Reset
The in-memory database is automatically reset when:
- Application restarts
- Application stops

## 7.2 Manual Reset
To reset during development:

1. Stop the application
2. Restart the application
3. Database is recreated with seed data

---

# 8. Querying Data

## 8.1 Using DbContext

```csharp
var courses = await dbContext.Courses.ToListAsync();
var enrollments = await dbContext.Enrollments
    .Include(e => e.Student)
    .Include(e => e.Course)
    .ToListAsync();
```

## 8.2 Debugging Queries
Use EF Core logging to see generated SQL:

```csharp
builder.Services.AddDbContext<EnrollmentContext>(options =>
{
    options.UseInMemoryDatabase("EnrollmentDb");
    options.LogTo(Console.WriteLine, LogLevel.Information);
});
```

---

# 9. Sample Data for Local Development

Local development requires **sample data** to test enrollment flows.

Below is **safe, synthetic** data following the official schema.

---

## 9.1 Students

```csharp
new Student
{
    Id = Guid.NewGuid(),
    Email = "student1@example.com",
    PasswordHash = BCrypt.HashPassword("Password123!"),
    FirstName = "John",
    LastName = "Doe",
    CreatedAt = DateTime.UtcNow
}

new Student
{
    Id = Guid.NewGuid(),
    Email = "student2@example.com",
    PasswordHash = BCrypt.HashPassword("Password123!"),
    FirstName = "Jane",
    LastName = "Smith",
    CreatedAt = DateTime.UtcNow
}
```

---

## 9.2 Courses

```csharp
new Course
{
    Id = Guid.NewGuid(),
    Name = "Introduction to Programming",
    Description = "Learn the fundamentals of programming including variables, control structures, and functions.",
    Capacity = 50,
    CreatedAt = DateTime.UtcNow
}

new Course
{
    Id = Guid.NewGuid(),
    Name = "Database Design",
    Description = "Design and implement relational databases using best practices.",
    Capacity = 30,
    CreatedAt = DateTime.UtcNow
}

new Course
{
    Id = Guid.NewGuid(),
    Name = "Web Development",
    Description = "Build modern web applications using current technologies.",
    Capacity = 40,
    CreatedAt = DateTime.UtcNow
}
```

---

## 9.3 Enrollments

```csharp
new Enrollment
{
    Id = Guid.NewGuid(),
    StudentId = student1Id,
    CourseId = course1Id,
    EnrolledAt = DateTime.UtcNow
}
```

---

# 10. How to Load Sample Data

### Option 1 — Automatic Seeding
Configure seed data in `DataExtensions.cs` initialization method.

### Option 2 — Manual Seeding
Create a separate seeding service and call it during startup.

---

# 11. First-Run Checklist

✔ Database context configured  
✔ In-memory provider configured  
✔ Initialization code added  
✔ Seed data configured  
✔ Application starts successfully  
✔ Database entities created  
✔ Sample data loaded  
✔ Integration tests can connect  

---

# 12. Limitations

The in-memory database does **not** support:

- Persistent storage (data lost on restart)
- Complex transactions
- Some advanced SQL features
- Production workloads

It **does** support:

- Basic CRUD operations
- Entity relationships
- LINQ queries
- Migrations (if configured)
- Testing scenarios

---

