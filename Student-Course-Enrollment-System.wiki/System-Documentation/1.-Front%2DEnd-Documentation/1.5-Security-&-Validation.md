# Student Course Enrollment System – Security & Validation Documentation
---

# 1. Overview

Frontend security, validation, and user-interface integrity enforcement. Covers Blazor components, models, client-side validation, UI authorization visibility rules, and safeguards that prevent unauthorized or invalid user interactions before data reaches the API.

---

# 2. Frontend Security Model

## 2.1 Authentication Boundary
Authentication is handled via environment-specific identity providers.  
The UI reflects the authenticated state provided by the authentication service.

### Environment-Specific Authentication

| Environment | Authentication Provider | Token Type |
|-------------|------------------------|------------|
| Local | OAuth 2.0 & OpenID Connect | JWT |
| Stage | Keycloak | JWT |
| Production | Entra ID (Azure AD) | JWT |

Frontend responsibilities:
- Display authenticated user info where needed (e.g., "Welcome, John").  
- Hide or disable UI elements when required permissions are missing.  
- Never trust the UI to enforce security — the API remains the authority.  

---

## 2.2 Authorization Visibility Rules
The frontend must visually enforce security by hiding or disabling UI interactions the user is not allowed to perform.

Examples:
- Enroll buttons appear only for authenticated students.  
- My Enrollments link appears only for authenticated users.  
- Students see only their own enrollments.  
- Unauthenticated users can only browse courses.  

UI visibility is determined by:
- Claims exposed through authentication.  
- Component properties like `IsAuthenticated`, `CanEnroll`, `CanViewEnrollments`.  

Visibility ≠ security.  
API endpoints **must still enforce authorization**.

---

## 2.3 Anti-Forgery
Blazor WASM handles anti-forgery automatically for server-side interactions:

```csharp
builder.Services.AddAntiforgery();
```

Components use anti-forgery tokens for form submissions.

---

## 2.4 Input Sanitization
While API validation is authoritative, the frontend should prevent obvious malformed inputs by:

- Using correct input types: `type="email"`, `type="password"`, etc.  
- Avoiding unsafe HTML injection.  
- Rendering user-generated content in encoded form (default in Razor).  

---

# 3. Frontend Validation Model

Frontend validation has two layers:

1. **Component-level validation**  
2. **API error feedback**

The frontend ensures a smooth user experience and catches basic errors early, but all validation must be mirrored on the API.

---

## 3.1 Client-Side Validation (DataAnnotations)

The frontend uses DataAnnotations on models:

- `[Required]`  
- `[EmailAddress]`  
- `[StringLength]`  
- `[Range]`  
- `[RegularExpression]`  

Example:

```csharp
public record RegisterRequest(
    [Required] string FirstName,
    [Required] string LastName,
    [Required, EmailAddress] string Email,
    [Required, MinLength(8)] string Password
);
```

Client-side validation ensures:
- Required fields are flagged before submission  
- Valid email syntax  
- Valid password format  
- Proper data types  

But API validation remains authoritative.

---

## 3.2 Server-Side Validation Feedback

When API validation fails:
- The component receives error response  
- Errors are displayed using validation helpers  
- Error summary shows business-rule errors  

Frontend responsibilities:
- Show API errors clearly  
- Retain user input on error  
- Ensure validation messages match associated fields  

Examples:
- "Email already registered"  
- "Course is full"  
- "Already enrolled in this course"  

---

# 4. Frontend Workflow Validation

Each enrollment workflow has UI validation steps.

## 4.1 Registration UI Rules
- Required fields visually marked  
- Email format validation  
- Password strength indicators  
- Password confirmation matching  
- Form submission disabled until valid  

---

## 4.2 Enrollment UI Rules
- Enroll button visible only when authenticated  
- Course capacity displayed  
- Enrollment status shown (enrolled/available)  
- Duplicate enrollment prevented in UI  
- Confirmation message displayed after enrollment  

---

## 4.3 Enrollment Management UI Rules
- Students can view only their own enrollments  
- Deregister button visible only for enrolled courses  
- Confirmation dialog before deregistration  
- Success/error messages displayed  

---

# 5. UI Error Handling

## 5.1 API Error Display
Frontend must:
- Display field-level errors inline  
- Display global errors in a summary  
- Highlight invalid fields using Bootstrap validation styles  

Example:

```razor
@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}

@foreach (var error in validationErrors)
{
    <div class="text-danger">@error</div>
}
```

## 5.2 Friendly Error Pages
For unhandled exceptions:
- A user-friendly error page must be displayed  
- No sensitive system details shown  

```razor
@page "/error"

<h1>An error occurred</h1>
<p>We're sorry, but something went wrong. Please try again later.</p>
```

---

# 6. Form Integrity Requirements

- All forms must bind to strongly typed models  
- All form fields must be validated both client-side and server-side  
- Hidden fields may be used only for non-sensitive values  
- Sensitive fields must never be placed in hidden inputs  

Example:
- Course ID can be hidden  
- Student ID must come from authentication, not hidden input  
- Authentication tokens must not be in hidden inputs  

---

# 7. Security of Frontend Assets

- Razor prevents cross-site scripting by default (HTML-encoding)  
- Scripts loaded using local bundles or trusted CDNs  
- No inline scripts for sensitive logic  
- No client-side storage of sensitive data  
- Authentication tokens stored securely (not in LocalStorage)  

---

# 8. Authentication Token Handling

Tokens are managed by the environment-specific authentication system:

## 8.1 Local Environment

```csharp
// Uses CustomAuthenticationStateProvider with JWT Bearer tokens (symmetric key)
builder.Services.AddScoped<CustomAuthenticationStateProvider>();
builder.Services.AddScoped<AuthenticationStateProvider>(sp => sp.GetRequiredService<CustomAuthenticationStateProvider>());
```

## 8.2 Production Environment

```csharp
// Uses Entra ID (Azure AD) for authentication
// Configured via appsettings.Production.json
```

Components access authentication state:

```razor
@inject AuthenticationStateProvider AuthenticationStateProvider

@code {
    private async Task<bool> IsAuthenticatedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        return authState.User.Identity?.IsAuthenticated == true;
    }
}
```

The authentication provider is configured based on the environment, but the component code remains the same across all environments.

---

# 9. Protected Routes

Routes are protected using authorization:

```razor
@page "/enrollments"
@attribute [Authorize]

@code {
    // Only authenticated users can access
}
```

Unauthenticated users are redirected to login:

```razor
<AuthorizeView>
    <Authorized>
        <NavLink href="/enrollments">My Enrollments</NavLink>
    </Authorized>
    <NotAuthorized>
        <NavLink href="/login">Login</NavLink>
    </NotAuthorized>
</AuthorizeView>
```

---

