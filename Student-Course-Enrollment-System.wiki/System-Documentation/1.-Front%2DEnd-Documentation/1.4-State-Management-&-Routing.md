# Student Course Enrollment System – State Management & Routing
---

# 1. Overview

How the system maintains user and workflow state and how navigation is structured across the application. Supports the Course Enrollment module and integrates with the Blazor WebAssembly architecture.

---

# 2. State Model

State flows through the system using client-side constructs that ensure predictable behavior, consistent validation, and alignment with enrollment workflows.

## 2.1 Component State
Components maintain page-level state including:

- Input fields  
- Validation messages  
- API data (courses, enrollments)  
- Workflow context (course ID, enrollment status)  

State is managed per component and refreshed from API as needed.

---

## 2.2 Component Parameters
Component parameters pass data between components:

```razor
<CourseCard Course="course" OnEnroll="HandleEnroll" />
```

```csharp
[Parameter]
public Course Course { get; set; }

[Parameter]
public EventCallback<Guid> OnEnroll { get; set; }
```

---

## 2.3 Dependency Injection Services
Services manage shared state:

- `EnrollmentState` → Enrollment state management  
- `AuthenticationStateProvider` → Authentication state  
- HTTP Clients → API communication  

Example:

```csharp
@inject EnrollmentState EnrollmentState

@code {
    protected override async Task OnInitializedAsync()
    {
        await EnrollmentState.LoadEnrollmentsAsync();
    }
}
```

---

## 2.4 Authentication State
User authentication state determines permissible actions:

- Student (`CanEnroll`, `CanViewEnrollments`)  
- Authenticated users can enroll and view their enrollments  
- Unauthenticated users can only browse courses  

Authentication state influences routing and UI visibility.

---

## 2.5 Database Persistence
In-memory database stores all authoritative state:

- Student data  
- Course data  
- Enrollment records  

Database state is always the single source of truth, accessed via API.

---

# 3. Routing Model

Routing uses Blazor WebAssembly routing conventions.

## 3.1 Route Structure
Format:

`@page "/route/{parameter}"`

### Authentication
- `/register` → Registration page  
- `/login` → Login page  
- `/access-denied` → Access denied page  

### Courses
- `/courses` → Available courses list  
- `/courses/{id:guid}` → Course details  

### Enrollments
- `/enrollments` → My enrollments  
- `/enrollments/{id:guid}` → Enrollment details  

---

## 3.2 Navigation Methods

### Declarative Navigation
```razor
<NavLink href="/courses">Browse Courses</NavLink>
```

### Programmatic Navigation
```csharp
@inject NavigationManager Navigation

Navigation.NavigateTo("/courses");
```

### Navigation with Parameters
```csharp
Navigation.NavigateTo($"/courses/{courseId}");
```

---

## 3.3 Route Parameters

Components receive route parameters:

```razor
@page "/courses/{id:guid}"

@code {
    [Parameter]
    public Guid Id { get; set; }
}
```

---

## 3.4 Workflow Transitions

### Enrollment Flow
1. Navigate to `/courses`
2. Click course → Navigate to `/courses/{id}`
3. Click enroll → POST to API
4. Navigate to `/enrollments` (with confirmation)

### Deregistration Flow
1. Navigate to `/enrollments`
2. Click deregister → DELETE to API
3. Refresh enrollments list

---

## 3.5 Access Control in Routing

All routes verify:

- Authentication (where required)  
- Authorization policies  
- User permissions  

Examples:

- Only authenticated students can enroll  
- Students can view only their own enrollments  
- Public access for browsing courses  

Protected routes:

```razor
@page "/enrollments"
@attribute [Authorize]

@code {
    // Only authenticated users can access
}
```

---

# 4. Interaction Between State and Routing

State mechanisms define what the user *can* do; routing defines where they *may* go.

- Component state presents UI data  
- Service state manages shared data  
- Authentication state regulates route access  
- API provides authoritative data  
- In-memory database stores long-term state  

---

# 5. State Management Patterns

## 5.1 Component-Level State

```csharp
@code {
    private List<Course> courses = new();
    private bool isLoading = true;
    
    protected override async Task OnInitializedAsync()
    {
        courses = await CoursesClient.GetCoursesAsync();
        isLoading = false;
    }
}
```

## 5.2 Service-Based State

```csharp
public class EnrollmentState
{
    private List<Enrollment> enrollments = new();
    
    public async Task LoadEnrollmentsAsync()
    {
        enrollments = await EnrollmentsClient.GetMyEnrollmentsAsync();
    }
    
    public List<Enrollment> GetEnrollments() => enrollments;
}
```

## 5.3 Event-Based State Updates

```csharp
@code {
    private async Task HandleEnroll(Guid courseId)
    {
        await EnrollmentsClient.EnrollAsync(courseId);
        // Update local state or refresh from API
        await RefreshEnrollmentsAsync();
    }
}
```

---

