# Student Course Enrollment System – Local Development Setup

# 1. Overview

This guide provides step-by-step instructions for setting up your local development environment for the Student Course Enrollment System. It covers required tools, configuration, database setup, authentication, and optional Azure resources for testing.

### Environments

The system supports three environments:

| Environment | Authentication | Database | Purpose |
|-------------|----------------|----------|---------|
| **Local** | JWT Bearer (Symmetric Key) | In-memory | Local development |
| **Production** | Microsoft Entra ID | In-memory | Live environment |

All environments use in-memory database that resets on application restart. Only authentication providers differ between environments.

---

# 2. Prerequisites

## 2.1 Required Tools

### Visual Studio 2022 or VS Code
- **Visual Studio 2022** (Community, Professional, or Enterprise)
  - Install with **ASP.NET and Web Development** workload
  - Recommended: Enable Roslyn analyzers and Full Solution Analysis
- **VS Code** (Alternative)
  - Install C# extension
  - Install .NET Extension Pack

### .NET 8 SDK
Install the .NET 8 SDK (LTS version).

Verify installation:
```bash
dotnet --version
```
Expected output: `8.x.x` or higher

### Git
Install Git and configure your identity:
```bash
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
git config --global core.autocrlf true
```

### Azure CLI (Optional - for Azure setup)
Install Azure CLI for managing Azure resources. See [Production Environment Setup](4.9-production_environment_setup.md#22-azure-cli) for installation instructions.

---

# 3. Solution Structure

## 3.1 Project Organization

```
/StudentCourseEnrollment.sln
/src
  /StudentCourseEnrollment.Api          # Minimal API backend
  /StudentCourseEnrollment.Frontend     # Blazor WebAssembly frontend
  /StudentCourseEnrollment.Shared       # Shared DTOs and models
/tests
  /StudentCourseEnrollment.Tests.Unit           # Unit tests
  /StudentCourseEnrollment.Tests.Integration    # Integration tests
```

---

# 4. Local Setup Steps

## 4.1 Clone Repository

```bash
git clone <repository-url>
cd "Student Course Enrollment System"
```

## 4.2 Restore Dependencies

```bash
dotnet restore
```

## 4.3 Verify Configuration

The `appsettings.Development.json` file should contain:

```json
{
  "Jwt": {
    "Issuer": "StudentCourseEnrollment",
    "Audience": "StudentCourseEnrollment",
    "SecretKey": "DevelopmentSecretKey-ChangeInProduction-Minimum32Characters"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore": "Warning"
    }
  }
}
```

**Note:** The secret key in development is for local testing only. Never use this key in production.

---

# 5. Database Configuration

## 5.1 In-Memory Database

The application uses **Entity Framework Core In-Memory Database** for local development. This means:

- **No connection string required** - The database is created in memory when the application starts
- **Data resets on restart** - All data is lost when the application stops
- **No external database needed** - No SQL Server, PostgreSQL, or other database installation required

### Database Initialization

The database is automatically initialized when the application starts via the `InitializeDbAsync()` method in `Program.cs`. This method:

1. Ensures the database is created
2. Seeds initial data (if configured)
3. Prepares the database for use

### Configuration Location

Database configuration is in `Program.cs`:

```csharp
builder.Services.AddEnrollmentContext(builder.Configuration);
```

The `AddEnrollmentContext` extension method configures the in-memory database provider.

---

# 6. Authentication Configuration

## 6.1 Local Development Authentication

Local development uses **JWT Bearer authentication with symmetric key validation**:

- Tokens are generated and validated using a shared secret key
- No external identity provider required
- Tokens include user claims (NameIdentifier, Email, Name, Role)
- Default role assignment: "Student" for regular users

### JWT Token Configuration

JWT settings are configured in `appsettings.Development.json`:

- **Issuer**: Token issuer identifier
- **Audience**: Token audience identifier  
- **SecretKey**: Symmetric key for signing and validating tokens (minimum 32 characters)

### Token Generation

When a user registers or logs in, the API generates a JWT token with:
- User ID (NameIdentifier claim)
- Email (Email claim)
- Name (Name claim)
- Roles (Role claims - default: "Student")

---

# 7. Running the Application

## 7.1 Start the API

```bash
cd src/StudentCourseEnrollment.Api
dotnet run
```

The API will start on:
- HTTPS: `https://localhost:49541`
- HTTP: `http://localhost:49542`

Swagger UI is available at: `https://localhost:49541/swagger`

## 7.2 Start the Frontend

In a new terminal:

```bash
cd src/StudentCourseEnrollment.Frontend
dotnet run
```

The frontend will start on:
- HTTPS: `https://localhost:5001`
- HTTP: `http://localhost:5000`

## 7.3 Verify Setup

1. Open browser to `https://localhost:5001`
2. Navigate to Swagger UI: `https://localhost:49541/swagger`
3. Test API endpoints:
   - Register a new user: `POST /auth/register`
   - Login: `POST /auth/login`
   - Get courses: `GET /courses`

---

# 8. Azure Setup (Optional)

This section covers setting up Azure resources for testing Entra ID authentication locally or preparing for production deployment.

## 8.1 Prerequisites

- Azure subscription
- Azure CLI installed (see section 2.1)
- Appropriate permissions to create Azure AD app registrations

## 8.2 Azure AD App Registration Setup

### Step 1: Login and Set Subscription

```bash
az login
az account set --subscription "<subscription-id-or-name>"  # If multiple subscriptions
```

### Step 3: Create Azure AD App Registration

```bash
# Create app registration
az ad app create \
  --display-name "StudentCourseEnrollment-Local" \
  --web-redirect-uris "https://localhost:5001/signin-oidc" "http://localhost:5000/signin-oidc" \
  --enable-id-token-issuance true
```

**Note:** Replace `StudentCourseEnrollment-Local` with your preferred app name.

### Step 4: Get App Registration Details

```bash
# Get app ID and tenant ID
az ad app list --display-name "StudentCourseEnrollment-Local" --query "[].{AppId:appId, DisplayName:displayName}" --output table
az account show --query tenantId --output tsv
```

Save the **Application (client) ID** as `ClientId` and **Directory (tenant) ID** as `TenantId`.

### Step 5: Create Client Secret

```bash
# Get the app ID from previous step
APP_ID="<your-app-id>"

# Create client secret (valid for 12 months)
az ad app credential reset --id $APP_ID --years 1
```

**Important:** Save the `password` value from the output - this is your client secret. It will not be shown again.

### Step 6: Configure API Permissions (Optional)

If you need to call Microsoft Graph API or other Azure services:

```bash
# Add Microsoft Graph API permission (example: User.Read)
az ad app permission add \
  --id $APP_ID \
  --api 00000003-0000-0000-c000-000000000000 \
  --api-permissions e1fe6dd8-ba31-4d61-89e7-88639da4683d=Scope

# Grant admin consent (requires admin privileges)
az ad app permission admin-consent --id $APP_ID
```

### Step 7: Configure App Registration in Azure Portal (Alternative Method)

If you prefer using the Azure Portal:

1. Navigate to [Azure Portal](https://portal.azure.com)
2. Go to **Azure Active Directory** → **App registrations**
3. Click **New registration**
4. Fill in:
   - **Name**: `StudentCourseEnrollment-Local`
   - **Supported account types**: Select appropriate option
   - **Redirect URI**: 
     - Platform: Web
     - URI: `https://localhost:5001/signin-oidc`
5. Click **Register**
6. Note the **Application (client) ID** and **Directory (tenant) ID**
7. Go to **Certificates & secrets** → **New client secret**
8. Create a secret and **copy the value immediately** (it won't be shown again)

### Step 8: Configure Local App Settings for Entra ID (Optional)

If you want to test Entra ID authentication locally, create `appsettings.Development.EntraId.json`:

```json
{
  "Authentication": {
    "Schemes": {
      "EntraId": {
        "Instance": "https://login.microsoftonline.com/",
        "TenantId": "<your-tenant-id>",
        "ClientId": "<your-client-id>",
        "ClientSecret": "<your-client-secret>",
        "CallbackPath": "/signin-oidc"
      }
    }
  },
  "Jwt": {
    "Issuer": "https://login.microsoftonline.com/<your-tenant-id>/v2.0",
    "Audience": "StudentCourseEnrollment"
  }
}
```

**Note:** The application currently uses JWT Bearer (symmetric key) for local development by default. To use Entra ID locally, you would need to modify the authentication configuration in `Program.cs`.

---

# 9. CORS Configuration

CORS (Cross-Origin Resource Sharing) is configured in `Program.cs` to allow the frontend to communicate with the API:

```csharp
builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        policy.WithOrigins(
                "https://localhost:5001",
                "http://localhost:5000")
              .AllowAnyHeader()
              .AllowAnyMethod()
              .AllowCredentials();
    });
});
```

**Local Development Origins:**
- `https://localhost:5001` - Frontend HTTPS
- `http://localhost:5000` - Frontend HTTP

If you change the frontend ports, update the CORS configuration accordingly.

---

# 10. First-Run Checklist

Use this checklist to verify your local setup:

- [ ] .NET 8 SDK installed and verified (`dotnet --version`)
- [ ] Visual Studio 2022 or VS Code installed
- [ ] Git installed and configured
- [ ] Repository cloned successfully
- [ ] Dependencies restored (`dotnet restore`)
- [ ] `appsettings.Development.json` exists and contains JWT configuration
- [ ] API starts successfully (`dotnet run` in `src/StudentCourseEnrollment.Api`)
- [ ] Frontend starts successfully (`dotnet run` in `src/StudentCourseEnrollment.Frontend`)
- [ ] API accessible at `https://localhost:49541`
- [ ] Frontend accessible at `https://localhost:5001`
- [ ] Swagger UI accessible at `https://localhost:49541/swagger`
- [ ] Can register a new user via API
- [ ] Can login and receive JWT token
- [ ] Can retrieve courses list
- [ ] Database initializes correctly (check logs)

---

# 11. Troubleshooting

## 11.1 Port Already in Use

If you get a port conflict error:

```bash
# Find process using the port (Windows)
netstat -ano | findstr :49541

# Kill the process (replace <PID> with actual process ID)
taskkill /PID <PID> /F
```

Or change the port in `Properties/launchSettings.json`:

```json
{
  "applicationUrl": "https://localhost:49543;http://localhost:49544"
}
```

## 11.2 HTTPS Certificate Issues

If you get certificate errors:

```bash
# Trust the development certificate
dotnet dev-certs https --trust
```

## 11.3 Database Not Initializing

Check the application logs for errors. Verify:
- `AddEnrollmentContext` is called in `Program.cs`
- `InitializeDbAsync()` is called before `app.Run()`
- No exceptions during database initialization

## 11.4 CORS Errors

If you see CORS errors in the browser console:
- Verify frontend URL matches CORS configuration in `Program.cs`
- Check that `AllowCredentials()` is set if using cookies/auth headers
- Ensure API is running and accessible

## 11.5 Authentication Issues

If JWT tokens are not working:
- Verify `appsettings.Development.json` has correct JWT configuration
- Check that secret key is at least 32 characters
- Ensure `JwtTokenService` is registered in dependency injection
- Verify token expiration (default: 24 hours)

## 11.6 Azure CLI Issues

If Azure CLI commands fail:
- Verify you're logged in: `az account show`
- Check you have appropriate permissions
- Ensure you're using the correct subscription
- Try logging out and back in: `az logout` then `az login`

---

# 12. Next Steps

After completing local setup:

1. **Run Tests**: Execute unit and integration tests to verify everything works
   ```bash
   dotnet test
   ```

2. **Review Documentation**: 
   - API Documentation: `2.-API-Documentation/`
   - Frontend Documentation: `1.-Front-End-Documentation/`
   - Architecture: `4.-Infrastructure-Documentation/architecture_ai_rules.md`

3. **Start Development**: Follow the workflow rules in `workflows_ai_rules.md`

---

# 13. Additional Resources

- [.NET 8 Documentation](https://learn.microsoft.com/en-us/dotnet/core/)
- [ASP.NET Core Minimal API](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis)
- [Blazor WebAssembly](https://learn.microsoft.com/en-us/aspnet/core/blazor/)
- [Entity Framework Core In-Memory Provider](https://learn.microsoft.com/en-us/ef/core/providers/in-memory/)
- [Azure AD App Registration](https://learn.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app)
- [JWT Authentication](https://jwt.io/)

---
