# Student Course Enrollment System – Source Control Strategy
---

# 1. Overview
This document describes the source control strategy for the Student Course Enrollment System.

---

# 2. Branching Model

## 2.1 Branch Types

The project uses a simplified branching model with reusable branches optimized for solo development:

| Branch Type       | Purpose                                | Protection Level | Pipeline Trigger |
|-------------------|-----------------------------------------|------------------|------------------|
| **main**          | Production-ready code                   | Highest          | CD Pipeline (manual, with approval) |
| **feature**       | Reusable feature branch                 | High             | CI Pipeline (automatic: build + test) |
| **userstory**     | Reusable user story branch              | Minimal          | None |
| **task**          | Reusable task branch                    | Minimal          | None |

## 2.2 Branch Workflow

```
main
  └── feature (reusable, triggers production pipeline)
            └── userstory (reusable)
            └── task (reusable)
```

**Workflow:**
- Work is done in reusable branches (`userstory`, `task`)
- Completed work is merged to `feature` via Pull Request
- `feature` branch triggers **CI pipeline** (build + test) automatically
- Validated work is merged to `main` via Pull Request
- `main` branch triggers **CD pipeline** (build + test + deploy) manually with approval gates
- `main` branch contains production-ready code

## 2.3 Branch Usage

### Reusable Branches

The `feature`, `userstory`, and `task` branches are **reusable** - they are not deleted after work is completed. Instead:

1. Work on a work item in the appropriate branch (`userstory` or `task`)
2. Commit with work item ID in commit message: `[WI-{workItemId}] ...`
3. When work is complete, merge to `feature` via Pull Request
4. `feature` branch automatically triggers **CI pipeline** (build + test)
5. After CI pipeline passes, merge to `main` via Pull Request
6. `main` branch triggers **CD pipeline** (build + test + deploy) manually with approval gates
7. Reset the branch and reuse it for the next work item

This approach simplifies branch management for solo development while maintaining full traceability through commit messages.

---

# 3. Commit Strategy

## 3.1 Commit Messages

All commit messages **MUST** reference the Azure DevOps work item ID for traceability.

### Commit Message Format

```
[WI-{workItemId}] <type>(<scope>): short imperative summary

Optional detailed explanation can follow, including:
Work Item: {workItemUrl}
```

### Commit Message Components

- **Header**: `[WI-{workItemId}]` - Work Item ID in square brackets (mandatory)
- **Type**: One of `feat`, `fix`, `chore`, `refactor`, `test`, `docs`, `ci`, `style`
- **Scope**: Optional, indicates the area affected (e.g., `auth`, `courses`, `enrollments`)
- **Summary**: Short, imperative description (e.g., "implement student registration")

### Allowed Types

- `feat` - New feature
- `fix` - Bug fix
- `chore` - Maintenance tasks
- `refactor` - Code refactoring
- `test` - Adding or updating tests
- `docs` - Documentation changes
- `ci` - CI/CD changes
- `style` - Code style changes (formatting, etc.)

### Examples

```
[WI-118] feat(auth): implement student registration and login

- Create RegisterPage and LoginPage Blazor components
- Implement AuthClient service
- Configure protected routes
- Create API endpoints for registration and login

Work Item: https://dev.azure.com/rock-assessments/Student%20Course%20Enrollment%20System/_workitems/edit/118
```

```
[WI-164] test(auth): add xUnit unit tests for authentication API endpoints

Work Item: https://dev.azure.com/rock-assessments/Student%20Course%20Enrollment%20System/_workitems/edit/164
```

### Mandatory Rules

- The commit header **MUST** start with `[WI-{workItemId}]`
- The commit **MUST** reference the task ID **AND** work item ID
- If `workItemId` cannot be found, the assistant must **STOP** and ask the user
- No commit may proceed without a referenced Work Item ID

## 3.2 Commit Frequency

- Commit frequently
- Small, logical commits
- One feature per commit

## 3.3 Work Item Traceability

All commits **MUST** be traceable to Azure DevOps work items. Since branches are reusable, work item traceability is maintained through commit messages and pull requests rather than branch names.

### Automatic Linking Methods

Azure DevOps automatically links work items when you use the following formats:

#### 1. Commit Messages (Automatic Linking)
When you commit with the format `[WI-{workItemId}]`, Azure DevOps automatically links the commit to the work item:

```
[WI-118] feat(auth): implement student registration
```

**How it works:**
- Azure DevOps scans commit messages for the `[WI-{workItemId}]` pattern
- The commit is automatically linked to the work item in Azure DevOps
- The work item appears in the "Commits" tab of the work item
- The commit appears in the work item's development history

#### 2. Pull Request Titles/Descriptions (Automatic Linking)
When you include the work item ID in PR titles or descriptions, Azure DevOps automatically links the PR:

**PR Title:**
```
[WI-118] Implement student registration and login
```

**PR Description:**
```
Work Item: WI-118
Work Item URL: https://dev.azure.com/rock-assessments/Student%20Course%20Enrollment%20System/_workitems/edit/118
```

**How it works:**
- Azure DevOps recognizes work item IDs in PR titles and descriptions
- The PR is automatically linked to the work item
- The work item appears in the "Pull Requests" tab
- You can also use `#118` in PR descriptions to link to work item 118

### Manual Linking (Required)

**IMPORTANT:** While automatic linking works for commits and PR titles/descriptions, you **MUST manually link work items in Pull Requests** for complete traceability:

1. Open the Pull Request in Azure DevOps
2. Go to the "Links" section
3. Click "Link to" → "Work Item"
4. Search for and select the work item
5. Save the link

This ensures the work item is properly associated with the PR and appears in all relevant views and reports.

### Traceability Requirements

- **Commit messages** must include `[WI-{workItemId}]` in the header
- **Pull Request titles** must include `[WI-{workItemId}]`
- **Pull Request descriptions** must include the work item ID and URL
- **Pull Requests** must have work items manually linked via the PR interface
- Each commit must reference the work item ID it addresses

This ensures full traceability from business tasks → commits → pull requests → code changes.

---

# 4. Pull Request Process

## 4.1 PR Requirements

- Code review required
- Tests must pass
- Documentation updated if needed

## 4.2 PR Workflow

1. Work in appropriate reusable branch (`userstory` or `task`)
2. Develop and test
3. Commit with `[WI-{workItemId}]` in commit message
4. Create pull request to `feature` branch (with WI-ID in title and description)
5. Code review
6. Merge to `feature` branch (triggers production pipeline)
7. Reset and reuse the branch for next work item

## 4.3 PR Requirements

All Pull Requests **MUST** include:

- Work Item ID in PR title: `[WI-{workItemId}] PR Title`
- Work Item link in PR description: `Work Item: {workItemUrl}`
- Summary of changes
- Tests added or updated
- Rule references (if applicable)

**IMPORTANT - Manual Work Item Linking:**
After creating the Pull Request, you **MUST manually link the work item** in the Azure DevOps PR interface:
1. Open the Pull Request in Azure DevOps
2. Navigate to the "Links" section
3. Click "Link to" → "Work Item"
4. Search for and select the work item
5. Save the link

This manual step is required because automated tools cannot access the Azure DevOps PR interface to create links. The automatic linking via commit messages and PR titles/descriptions provides initial traceability, but manual linking ensures the work item appears in all PR views and reports.

## 4.4 Workflow Phases

Development follows these mandatory phases:

- **@Plan**: Load rules, map work items, present plan, wait for approval
- **@Code**: Run tests, implement, verify, no commits
- **@Review**: Summarize changes, confirm workItemId, wait for approval
- **@Investigate**: Analyze errors, identify root cause (if needed)
- **@Fix**: Fix code, re-run tests (if needed)
- **@Commit**: Stage, generate commit message with WI-ID, create PR with work item link

See `workflows_ai_rules.md` for detailed workflow documentation.

---

# 5. Version Control Best Practices

## 5.1 File Organization

- Keep repository structure clean
- Don't commit sensitive data
- Use .gitignore appropriately

## 5.2 Documentation

- Keep documentation in sync with code
- Update README when needed
- Document breaking changes

---

