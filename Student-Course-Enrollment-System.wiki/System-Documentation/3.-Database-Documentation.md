# Student Course Enrollment System – Database Documentation Overview

---

## 1. Overview

The Student Course Enrollment System uses **in-memory database** for all environments:

- **Local Environment**: In-memory database
- **Stage Environment**: In-memory database
- **Production Environment**: In-memory database

The database resets on application restart in all environments.

The database stores:

- Students  
- Courses  
- Enrollments  

---

## 2. Database Technology

| Environment | Technology | Version | Notes |
|------------|------------|---------|-------|
| Local | EF Core In-Memory Provider | Latest | Resets on restart |
| Stage | EF Core In-Memory Provider | Latest | Resets on restart |
| Production | EF Core In-Memory Provider | Latest | Resets on restart |
| All | Entity Framework Core | .NET 8 | ORM framework |

All environments use the same in-memory database technology. Only authentication providers differ between environments.

---

## 3. Database Schema

### 3.1 Student Entity

```csharp
public class Student
{
    public Guid Id { get; set; }
    public string Email { get; set; }
    public string PasswordHash { get; set; }
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public DateTime CreatedAt { get; set; }
    
    // Navigation property
    public ICollection<Enrollment> Enrollments { get; set; }
}
```

### 3.2 Course Entity

```csharp
public class Course
{
    public Guid Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    public int Capacity { get; set; } // Optional
    public DateTime CreatedAt { get; set; }
    
    // Navigation property
    public ICollection<Enrollment> Enrollments { get; set; }
}
```

### 3.3 Enrollment Entity

```csharp
public class Enrollment
{
    public Guid Id { get; set; }
    public Guid StudentId { get; set; }
    public Guid CourseId { get; set; }
    public DateTime EnrolledAt { get; set; }
    
    // Navigation properties
    public Student Student { get; set; }
    public Course Course { get; set; }
}
```

---

## 4. Relationships

### 4.1 Student ↔ Enrollment (One-to-Many)

- A student can have multiple enrollments  
- Each enrollment belongs to one student  

### 4.2 Course ↔ Enrollment (One-to-Many)

- A course can have multiple enrollments  
- Each enrollment belongs to one course  

### 4.3 Many-to-Many Relationship

- Students and Courses have a many-to-many relationship through Enrollments  

---

## 5. Database Context

```csharp
public class EnrollmentContext : DbContext
{
    public DbSet<Student> Students => Set<Student>();
    public DbSet<Course> Courses => Set<Course>();
    public DbSet<Enrollment> Enrollments => Set<Enrollment>();
    
    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        // Configure relationships
        modelBuilder.Entity<Enrollment>()
            .HasOne(e => e.Student)
            .WithMany(s => s.Enrollments)
            .HasForeignKey(e => e.StudentId);
            
        modelBuilder.Entity<Enrollment>()
            .HasOne(e => e.Course)
            .WithMany(c => c.Enrollments)
            .HasForeignKey(e => e.CourseId);
            
        // Prevent duplicate enrollments
        modelBuilder.Entity<Enrollment>()
            .HasIndex(e => new { e.StudentId, e.CourseId })
            .IsUnique();
    }
}
```

---

## 6. Database Initialization

The in-memory database is initialized on application startup:

```csharp
public static async Task InitializeDbAsync(this WebApplication app)
{
    using var scope = app.Services.CreateScope();
    var db = scope.ServiceProvider.GetRequiredService<EnrollmentContext>();
    
    // Seed sample data
    if (!db.Courses.Any())
    {
        db.Courses.AddRange(
            new Course { Name = "Introduction to Programming", Description = "..." },
            new Course { Name = "Database Design", Description = "..." }
        );
        await db.SaveChangesAsync();
    }
}
```

---

## 7. Data Access Patterns

### 7.1 Query Pattern

```csharp
var courses = await dbContext.Courses
    .Include(c => c.Enrollments)
    .ThenInclude(e => e.Student)
    .ToListAsync();
```

### 7.2 Create Pattern

```csharp
var enrollment = new Enrollment
{
    StudentId = studentId,
    CourseId = courseId,
    EnrolledAt = DateTime.UtcNow
};
dbContext.Enrollments.Add(enrollment);
await dbContext.SaveChangesAsync();
```

### 7.3 Delete Pattern

```csharp
var enrollment = await dbContext.Enrollments
    .FirstOrDefaultAsync(e => e.StudentId == studentId && e.CourseId == courseId);
    
if (enrollment != null)
{
    dbContext.Enrollments.Remove(enrollment);
    await dbContext.SaveChangesAsync();
}
```

---

## 8. Constraints & Validation

### 8.1 Unique Constraints

- Student email must be unique  
- Enrollment (StudentId, CourseId) combination must be unique  

### 8.2 Required Fields

- Student: Email, PasswordHash, FirstName, LastName  
- Course: Name, Description  
- Enrollment: StudentId, CourseId, EnrolledAt  

---


