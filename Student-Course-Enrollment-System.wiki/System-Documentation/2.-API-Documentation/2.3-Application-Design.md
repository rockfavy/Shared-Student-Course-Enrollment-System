# Student Course Enrollment System – Application Design Documentation
---

# 1. Overview

Application-level design including core API components, their responsibilities, interactions, data structures, service boundaries, integration points, configuration, and operational considerations.

It translates business workflows and enrollment requirements (Authentication, Courses, Enrollments) into a cohesive API architecture implemented using:

- ASP.NET Core Minimal API
- Feature-based endpoints
- EF Core (In-Memory Database)
- JWT/OIDC authentication
- HTTP-based communication

---

# 2. High-Level Architecture

The system follows a **Minimal API** architecture:

- Separate API and Frontend projects
- Feature-based endpoint organization
- HTTP communication between frontend and API
- In-memory database for development

### Layered Layout

```text
API Layer
  - Minimal API Endpoints
  - Feature-based organization
  - DTOs

Data Layer
  - EF Core DbContext
  - In-Memory Database
  - Domain Models

Cross-Cutting
  - Logging
  - Authorization
  - Error Handling
  - Configuration
```

Architecture decisions are driven by enrollment requirements and data persistence constraints.

---

# 2.1 Vertical Slice Architecture

The API uses **vertical slice** architecture where code is organized by business features rather than technical layers. Each feature slice is self-contained with its own:

- Endpoints (`*Endpoints.cs`)
- DTOs (Request/Response models)
- Business logic (services)
- Data access (within the feature context)

Example structure:
```text
/Features/Auth
  AuthEndpoints.cs          # Endpoints
  RegisterRequest.cs        # DTOs
  LoginRequest.cs
  AuthService.cs            # Business logic
  (uses shared EnrollmentContext)

/Features/Courses
  CoursesEndpoints.cs       # Endpoints
  CourseDto.cs              # DTOs
  CourseService.cs          # Business logic
  (uses shared EnrollmentContext)
```

Each feature slice is independent and can evolve separately while sharing common infrastructure (database context, authentication, logging).

---

# 3. Core Components & Responsibilities

## 3.1 API Layer

### Endpoints
- Feature-based organization:
  - `AuthEndpoints` → Authentication endpoints
  - `CoursesEndpoints` → Course CRUD endpoints
  - `EnrollmentsEndpoints` → Enrollment management endpoints
- Perform:
  - Request validation
  - Permission checks
  - Mapping DTOs → domain models
  - HTTP response handling
- **Never implement business logic directly**

### DTOs
- Request/Response DTOs for each endpoint
- Organized with endpoints in feature folders
- DTOs contain:
  - Input validation attributes
  - Response data structures

---

# 3.2 Domain Layer

### Domain Models
Rich domain entities enforcing invariants:

- **Student**
- **Course**
- **Enrollment**

Entities validate invariants on creation and state changes.

### Business Logic
Business rules enforced in endpoints:

- Enrollment validation
- Duplicate prevention
- Authentication requirements
- Authorization checks

---

# 3.3 Data Access Layer

### DbContext
- `EnrollmentContext` → EF Core DbContext
- Responsibilities:
  - Define entity relationships
  - Configure database schema
  - Manage in-memory database
  - Handle migrations (if applicable)

### Data Models
Entity models for database:

- `Student` entity
- `Course` entity
- `Enrollment` entity

---

# 3.4 Infrastructure & Cross-Cutting Services

### Database Configuration
- `DataExtensions` → Database initialization
- `EnrollmentContext` → EF Core configuration

### Logging
- Built-in .NET logging
- Structured logging support

### Error Handling
- `GlobalExceptionHandler` → Global error handling
- Problem Details (RFC 7807) for error responses

### Security
- JWT/OIDC authentication
- Authorization policies
- Claims-based access control

---

# 4. Feature Organization

## 4.1 Authentication Feature

```text
/Features/Auth
  AuthEndpoints.cs
  Register/
    RegisterDtos.cs
    RegisterEndpoint.cs
  Login/
    LoginDtos.cs
    LoginEndpoint.cs
```

Responsibilities:
- Student registration
- Student login
- Token generation
- Authentication validation

---

## 4.2 Courses Feature

```text
/Features/Courses
  CoursesEndpoints.cs
  GetCourses/
    GetCoursesDtos.cs
    GetCoursesEndpoint.cs
  GetCourse/
    GetCourseDtos.cs
    GetCourseEndpoint.cs
  CreateCourse/
    CreateCourseDtos.cs
    CreateCourseEndpoint.cs
  UpdateCourse/
    UpdateCourseDtos.cs
    UpdateCourseEndpoint.cs
  DeleteCourse/
    DeleteCourseEndpoint.cs
```

Responsibilities:
- Course CRUD operations
- Course listing
- Course details

---

## 4.3 Enrollments Feature

```text
/Features/Enrollments
  EnrollmentsEndpoints.cs
  Enroll/
    EnrollDtos.cs
    EnrollEndpoint.cs
  GetMyEnrollments/
    GetMyEnrollmentsDtos.cs
    GetMyEnrollmentsEndpoint.cs
  Deregister/
    DeregisterDtos.cs
    DeregisterEndpoint.cs
```

Responsibilities:
- Student enrollment
- Enrollment retrieval
- Enrollment removal

---

# 5. Data Flow

## 5.1 Request Flow

```
HTTP Request
  ↓
Endpoint Handler
  ↓
DTO Validation
  ↓
Business Logic
  ↓
DbContext (Database)
  ↓
Response DTO
  ↓
HTTP Response
```

## 5.2 Authentication Flow

```
HTTP Request with Token
  ↓
Authentication Middleware
  ↓
Authorization Check
  ↓
Endpoint Handler
  ↓
Response
```

---

# 6. Configuration

## 6.1 Application Configuration

- `appsettings.json` → Default configuration
- `appsettings.Development.json` → Development overrides
- Database connection strings
- Authentication settings
- API URLs

## 6.2 Dependency Injection

Services registered in `Program.cs`:

- DbContext
- HTTP clients
- Authentication services
- Authorization handlers
- Error handlers

---

# 7. Error Handling

## 7.1 Global Exception Handler

```csharp
public class GlobalExceptionHandler : IExceptionHandler
{
    // Handle exceptions globally
    // Return Problem Details
}
```

## 7.2 Error Response Format

```json
{
  "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
  "title": "One or more validation errors occurred",
  "status": 400,
  "errors": {
    "Email": ["Email is required"]
  }
}
```

---

# 8. Security Architecture

## 8.1 Authentication

Authentication varies by environment:

### Local Environment
- **JWT Bearer (Symmetric Key)**
- Symmetric key validation
- No external identity provider required

### Production Environment
- **Microsoft Entra ID**
- Entra ID identity provider

All environments use JWT token-based authentication with token validation middleware and claims extraction.

## 8.2 Authorization

- Policy-based authorization
- Role-based access control
- Resource-based authorization
- Environment-agnostic authorization policies

---

# 9. Performance Considerations

## 9.1 Database Queries

- Use `AsNoTracking()` for read-only queries
- Include related entities efficiently
- Pagination for large datasets

## 9.2 Caching

- Consider caching for frequently accessed data
- Cache invalidation strategies

---

# 10. Design Principles

The API follows established software engineering principles to ensure maintainability, testability, and scalability.

## SOLID Principles

- **Single Responsibility Principle (SRP)**: Each endpoint, service, and class has one clear responsibility. For example, `AuthEndpoints` handles only authentication, `CoursesEndpoints` handles only course operations.

- **Open/Closed Principle (OCP)**: The system is open for extension (new features) but closed for modification. New features are added as new endpoint groups without modifying existing code.

- **Liskov Substitution Principle (LSP)**: Interfaces and abstractions are designed so implementations can be substituted without breaking functionality.

- **Interface Segregation Principle (ISP)**: Interfaces are focused and specific. Clients depend only on methods they actually use.

- **Dependency Inversion Principle (DIP)**: High-level modules (endpoints) depend on abstractions (services/interfaces), not concrete implementations. Dependencies are injected via constructor injection.

## KISS (Keep It Simple, Stupid)

- Prefer simple, straightforward solutions over complex abstractions
- Use Minimal API's built-in features rather than creating unnecessary layers
- Keep endpoint logic focused and readable
- Avoid premature optimization or over-engineering

## DRY (Don't Repeat Yourself)

- Extract common functionality into reusable services or utilities
- Share DTOs and models across related endpoints where appropriate
- Avoid duplicating validation logic, business rules, or data access patterns
- Use shared infrastructure (logging, error handling, authentication) consistently

## YAGNI (You Aren't Gonna Need It)

- Implement only what is needed for current requirements
- Avoid adding features "just in case"
- Focus on the enrollment system's core functionality
- Refactor and extend only when actual needs arise

---