# Student Course Enrollment System â€“ Business Rules Documentation
---

# 1. Overview

Authoritative business rules governing 
- **Student Authentication**
- **Course Management**
- **Enrollment Management**  

Each rule is expressed so it can be enforced consistently across:

- API Endpoints  
- Business Logic  
- Data Access  
- Validation  
- Authorization  

Rules cover: role/claim requirements, state transitions, validation constraints, audit obligations, idempotency, and security requirements.

---

# 2. Actors & Claims

## 2.1 Roles & Permissions
**Student**
- CanRegister  
- CanLogin  
- CanBrowseCourses  
- CanEnroll  
- CanViewOwnEnrollments  
- CanDeregister  

**Admin** (if applicable)
- CanManageCourses  
- CanViewAllEnrollments  

## 2.2 Enforcement
- Claims determine access to API endpoints.  
- All endpoints must verify required claims **before** processing requests.  
- Business logic must also enforce claims for sensitive operations.

---

# 3. Authentication Rules

## 3.1 Registration & Uniqueness
- Required fields: `firstName`, `lastName`, `email`, `password`.  
- Email must be unique across all students.  
- Duplication is checked before persistence.  
- A duplicate registration attempt must **fail validation**.  
- Password must meet strength requirements (minimum length, complexity).

## 3.2 Login & Authentication
- Email and password must match existing student record.  
- Authentication tokens must be generated upon successful login.  
- Tokens must include student ID and claims.  
- Failed login attempts should not reveal whether email exists.

## 3.3 Password Security
- Passwords must be hashed before storage.  
- Never return password hashes in API responses.  
- Password reset functionality (if implemented) must follow secure practices.

---

# 4. Course Management Rules

## 4.1 Course Creation & Validation
- Required fields: `name`, `description`.  
- Course name should be unique (if applicable).  
- Course capacity must be positive integer (if applicable).  
- Course creation may require admin permissions (if applicable).

## 4.2 Course Updates
- Only authorized users can update courses.  
- Updates must validate all fields.  
- **Course capacity updates must be validated**: New capacity must be >= current enrollment count.
- **Error message must be clear**: "Cannot set capacity to {newCapacity}. Course currently has {currentEnrollments} enrolled students" if validation fails.
- Course updates must not affect existing enrollments negatively.
- Display current enrollment count in update forms to guide admins.

## 4.3 Course Deletion
- **Courses with existing enrollments cannot be deleted** - deletion must be prevented if enrollments exist.
- **Error message must be clear**: "Cannot delete course '{courseName}' because it has {count} active enrollment(s). Please remove all enrollments first."
- Deletion must consider impact on enrolled students.  
- **Handle race conditions**: Check course existence atomically during deletion to prevent issues if course is deleted while students are enrolling.
- Consider providing bulk deregistration option before deletion (future enhancement).

---

# 5. Enrollment Management Rules

## 5.1 Enrollment Creation
- Student must be authenticated.  
- Course must exist.  
- Student must not already be enrolled in the same course (duplicate prevention).  
- **Course capacity must be checked and enforced** - enrollment must fail if current enrollments >= course capacity.
- **Concurrent enrollment requests must be handled atomically** to prevent race conditions that could exceed capacity.
- Enrollment record must include:
  - Student ID
  - Course ID
  - Enrollment date
- **Error message must be clear**: "This course is full. Capacity: X students" when capacity is reached.

## 5.2 Enrollment Retrieval
- Students can view only their own enrollments.  
- Enrollment list must include course details.  
- Empty enrollment list must be handled gracefully.

## 5.3 Enrollment Removal (Deregistration)
- Student must be authenticated.  
- Enrollment must exist.  
- Enrollment must belong to the authenticated student.  
- Deregistration must remove the enrollment record.  
- Confirmation must be returned to student.

---

# 6. Data Integrity Rules

## 6.1 Student Data
- Student email must be unique.  
- Student records must not be deleted if enrollments exist (or handle cascade).  
- Student data must be validated on creation and updates.

## 6.2 Course Data
- Course data must be validated.  
- Course relationships must be maintained.  
- Course deletion must consider enrollment dependencies.

## 6.3 Enrollment Data
- Enrollment must reference valid student.  
- Enrollment must reference valid course.  
- Duplicate enrollments (same student + course) must be prevented.  
- Enrollment date must be set automatically.

---

# 7. Validation Rules

## 7.1 Input Validation
- All required fields must be validated.  
- Email format must be validated.  
- String lengths must be within limits.  
- Numeric values must be within valid ranges.

## 7.2 Business Validation
- Business rules must be validated before persistence.  
- Validation errors must be returned clearly.  
- Multiple validation errors must all be returned.

---

# 8. Authorization Rules

## 8.1 Endpoint Authorization
- Public endpoints: Course browsing (if applicable).  
- Authenticated endpoints: Enrollment operations.  
- Admin endpoints: Course management (if applicable).

## 8.2 Resource Authorization
- Students can only access their own enrollments.  
- Students cannot modify other students' data.  
- Admin operations require appropriate permissions.

---

# 9. Error Handling Rules

## 9.1 Error Responses
- Validation errors must return 400 Bad Request.  
- Authentication errors must return 401 Unauthorized.  
- Authorization errors must return 403 Forbidden.  
- Not found errors must return 404 Not Found.  
- Server errors must return 500 Internal Server Error.

## 9.2 Error Messages
- Error messages must be user-friendly and actionable.  
- Error messages must not expose sensitive information (database errors, stack traces, etc.).  
- Error details must be logged for debugging (server-side only).
- **Technical errors should be translated to user-friendly messages**:
  - Network timeouts: "Please check your internet connection and try again"
  - Validation errors: Clear field-specific messages
  - Authorization errors: "You do not have permission to perform this action"
  - Capacity errors: "This course is full. Capacity: X students"

---

# 10. Idempotency Rules

## 10.1 Enrollment Operations
- Multiple enrollment requests for the same course must be idempotent.  
- Duplicate enrollment attempts must return appropriate response.  
- Deregistration must be idempotent (safe to call multiple times).

---

# 11. Audit & Logging Rules

## 11.1 Audit Requirements
- All enrollment operations should be logged.  
- Authentication events should be logged.  
- Important state changes should be logged.

## 11.2 Logging Format
- Use structured logging.  
- Include relevant context (student ID, course ID, etc.).  
- Log security-relevant events.

---

# 12. Performance Rules

## 12.1 Query Optimization
- Use efficient database queries.  
- Avoid N+1 query problems.  
- Use pagination for large datasets.

## 12.2 Response Times
- API responses should be fast.  
- Database queries should be optimized.  
- Consider caching for frequently accessed data.

---

