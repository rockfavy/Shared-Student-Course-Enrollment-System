# Student Course Enrollment System – Authentication Configuration Documentation
---

# 1. Overview

Authentication configuration for each environment. The system uses different identity providers for each environment to support development and production scenarios.

---

# 2. Environment-Specific Authentication

## 2.1 Local Environment

### Authentication Provider
**JWT Bearer Authentication (Symmetric Key)**

### Configuration
- Configured in `appsettings.Development.json`
- Self-issued JWT tokens using symmetric key validation
- No external identity provider required

### Setup Requirements
- JWT configuration with Issuer, Audience, and SecretKey
- Symmetric key validation configured in `Program.cs`
- Token generation handled by API's `JwtTokenService`

---

## 2.2 Production Environment

### Authentication Provider
**JWT Bearer Authentication (Entra ID as Token Issuer)**

### Configuration
- Configured in `appsettings.Production.json`
- Entra ID configured as JWT token issuer
- JWT Bearer validation validates tokens issued by Entra ID

### Setup Requirements
- Azure AD app registration
- Tenant ID configuration
- Client ID and secret (stored in Key Vault)
- JWT Bearer token validation configured with Entra ID authority URL

### Entra ID Configuration
- Tenant ID: (Azure AD tenant)
- Client ID: (App registration client ID)
- Client Secret: (stored in Azure Key Vault)
- Authority URL: Entra ID instance URL for token validation

---

# 3. Authentication Flow

## 3.1 Development Environment Flow

```
User → Frontend → API Login Endpoint → JWT Token (self-issued) → API
```

1. User initiates login via frontend
2. Frontend sends credentials to API login endpoint
3. API validates credentials and generates JWT token using symmetric key
4. API returns JWT token to frontend
5. Frontend stores token
6. Frontend sends token with API requests
7. API validates token using symmetric key
8. API processes request

## 3.2 Production Environment Flow

```
User → Frontend → Identity Provider (Entra ID) → JWT Token → API
```

1. User initiates login via frontend
2. Frontend redirects to Entra ID (Azure AD)
3. User authenticates with Entra ID
4. Entra ID issues JWT token
5. Frontend receives and stores JWT token
6. Frontend sends token with API requests
7. API validates token using Entra ID's authority URL
8. API processes request

---

# 4. Token Configuration

All environments use **JWT (JSON Web Tokens)** for authentication.

## 4.2 Token Claims

Common claims across all environments:
- `sub` (subject/user ID)
- `email`
- `name`
- `roles`
- Custom enrollment claims

## 4.3 Token Validation

- Token signature validation
- Token expiration validation
- Issuer validation
- Audience validation

---

# 5. Configuration Files

## 5.1 Local Environment (`appsettings.Development.json`)

```json
{
  "Jwt": {
    "Issuer": "StudentCourseEnrollment",
    "Audience": "StudentCourseEnrollment",
    "SecretKey": "DevelopmentSecretKey-ChangeInProduction-Minimum32Characters"
  }
}
```

## 5.2 Production Environment (`appsettings.Production.json`)

```json
{
  "Authentication": {
    "Schemes": {
      "EntraId": {
        "Instance": "https://login.microsoftonline.com/",
        "TenantId": "...",
        "ClientId": "...",
        "ClientSecret": "...",
        "CallbackPath": "/signin-oidc"
      }
    }
  },
  "Jwt": {
    "Issuer": "https://login.microsoftonline.com/{tenant-id}/v2.0",
    "Audience": "{client-id}"
  }
}
```

---

# 6. Environment Detection

## 6.1 Environment Variable

Authentication provider is selected based on:

```csharp
if (builder.Environment.IsDevelopment())
{
    // JWT Bearer with symmetric key validation (self-issued tokens)
}
else
{
    // JWT Bearer with Entra ID as token issuer (Production)
}
```

---

# 7. Migration Between Environments

## 7.1 Configuration Changes

When moving between environments:
- Update `appsettings.{Environment}.json`
- Configure identity provider
- Update redirect URIs
- Update client secrets
- Test authentication flow

## 7.2 Testing

- Test authentication flow in each environment
- Verify token validation
- Verify claims extraction
- Test authorization policies

---

# 8. Security Considerations

## 8.1 Secrets Management

- **Local**: Store in `appsettings.Development.json` (never commit)
- **Production**: Store in Azure Key Vault

## 8.2 Token Security

- Use HTTPS for all token transmission
- Validate token signature
- Validate token expiration
- Validate token issuer

---

# 9. Troubleshooting

## 9.1 Common Issues

- **Token validation failures**: Check issuer and audience
- **Redirect URI mismatches**: Verify redirect URI configuration
- **Client secret errors**: Verify secret is correct
- **Environment detection**: Verify `ASPNETCORE_ENVIRONMENT` variable

---

# 10. Best Practices

## 10.1 Configuration

- Use environment-specific configuration files
- Never commit secrets to version control
- Use secure secret storage for production
- Document configuration requirements

## 10.2 Testing

- Test authentication in each environment
- Verify token claims
- Test authorization policies
- Validate error handling

---

